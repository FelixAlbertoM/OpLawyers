@using Microsoft.AspNetCore.Components.Authorization
@using Microsoft.AspNetCore.Identity
@using OpLawyers.Models
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject NavigationManager Navigation
@inject UserManager<Usuario> UserManager
@inject SignInManager<Usuario> SignInManager

<div class="nav-bar">
    <div class="container-fluid">
        <nav class="navbar navbar-expand-lg bg-dark navbar-dark">
            <a href="#" class="navbar-brand">MENÚ</a>
            <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarCollapse">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse justify-content-between" id="navbarCollapse">
                <div class="navbar-nav mr-auto">
                    <a href="/" class="nav-item nav-link">Inicio</a>

                    <AuthorizeView Roles="Cliente">
                        <Authorized>
                            <a href="/mis-casos" class="nav-item nav-link">Mis Casos</a>
                            <a href="/citas" class="nav-item nav-link">Mis Citas</a>
                            <a href="/casos/consultar" class="nav-item nav-link">Consultar Casos</a>
                        </Authorized>
                    </AuthorizeView>

                    <AuthorizeView Roles="Administrador">
                        <Authorized>
                            <a href="/casos/admin" class="nav-item nav-link">Gestión de Casos</a>
                            <a href="/clientes" class="nav-item nav-link">Clientes</a>
                            <a href="/citas" class="nav-item nav-link">Citas</a>
                            <a href="/casos/consultar" class="nav-item nav-link">Consultar Casos</a>
                            <a href="/horarios/admin" class="nav-item nav-link">Horarios</a>
                        </Authorized>
                    </AuthorizeView>
                </div>


                <div class="ml-auto d-flex align-items-center">
                    <AuthorizeView Context="authContext">
                        <Authorized>
                            <span class="text-white mr-3">
                                <i class="fas fa-user"></i> @authContext.User.Identity?.Name
                            </span>
                            <form action="Account/Logout" method="post" class="d-inline">
                                <AntiforgeryToken />
                                <input type="hidden" name="ReturnUrl" value="@currentUrl" />
                                <button type="submit" class="btn btn-outline-light btn-sm">
                                    <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
                                </button>
                            </form>
                        </Authorized>
                        <NotAuthorized>
                            <a class="btn" href="Account/Login">
                                <i class="fas fa-sign-in-alt"></i> Iniciar Sesión
                            </a>
                        </NotAuthorized>
                    </AuthorizeView>
                </div>
            </div>
        </nav>
    </div>
</div>

@code {
    private string? currentUrl;

    protected override void OnInitialized()
    {
        currentUrl = Navigation.ToBaseRelativePath(Navigation.Uri);
    }
}

